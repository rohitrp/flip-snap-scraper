var testData = {"success":true,"results":{"flipkart":{"products":[{"emi":"EMI from Rs. 897 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/9/k/q/motorola-moto-x-play-xt1562-125x125-imaeb7fdsmje8bt5.jpeg","link":"http://www.flipkart.com/moto-x-play/p/itmeajtqyhrnkwrz?pid=MOBEAJTQWXAQH9KQ&ref=L%3A-4570749324777469411&srno=p_1&query=moto&otracker=from-search","price":" Rs. 18,499","ratings":"4 stars","reviews":"3303","title":"Moto X Play (Black, 32 GB)"},{"emi":"EMI from Rs. 825 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/9/k/q/motorola-moto-x-play-xt1562-125x125-imaeb7fdsmje8bt5.jpeg","link":"http://www.flipkart.com/moto-x-play/p/itmeajtqp9sfxgsk?pid=MOBEAJTQRH4CCRYM&ref=L%3A-4570749324777469411&srno=p_2&query=moto&otracker=from-search","price":" Rs. 16,999","ratings":"4 stars","reviews":"2253","title":"Moto X Play (Black, 16 GB)"},{"emi":"EMI from Rs. 897 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/f/h/a/motorola-moto-x-play-xt1562-125x125-imaeb7fcpgftfvfq.jpeg","link":"http://www.flipkart.com/moto-x-play/p/itmeajtqyhrnkwrz?pid=MOBEAJTQGSBHEFHA&ref=L%3A-4570749324777469411&srno=p_3&query=moto&otracker=from-search","price":" Rs. 18,499","ratings":"4 stars","reviews":"3303","title":"Moto X Play (White, 32 GB)"},{"emi":"EMI from Rs. 825 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/f/h/a/motorola-moto-x-play-xt1562-125x125-imaeb7fcpgftfvfq.jpeg","link":"http://www.flipkart.com/moto-x-play/p/itmeajtqp9sfxgsk?pid=MOBEAJTQ8XK783CX&ref=L%3A-4570749324777469411&srno=p_4&query=moto&otracker=from-search","price":" Rs. 16,999","ratings":"4 stars","reviews":"2253","title":"Moto X Play (White, 16 GB)"},{"emi":"EMI from Rs. 728 ","features":[],"image":"http://img6a.flixcart.com/image/mobile/w/q/h/motorola-xt1092-125x125-imadzqtcxbfkenfn.jpeg","link":"http://www.flipkart.com/moto-x-2nd-generation/p/itme7yb9cj9ghfvg?pid=MOBDZ3FVVZT38WQH&ref=L%3A-4570749324777469411&srno=p_5&query=moto&otracker=from-search","price":"Rs. 14,999","ratings":"4 stars","reviews":"1541","title":"Moto X (2nd Generation) (Black, 16 GB)"},{"emi":"EMI from Rs. 1,164 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/c/d/w/motorola-xt1092-125x125-imadzv552hzkamyr.jpeg","link":"http://www.flipkart.com/moto-x-2nd-generation/p/itme7yb9cj9ghfvg?pid=MOBDZ3FVJ3VNCCDW&ref=L%3A-4570749324777469411&srno=p_6&query=moto&otracker=from-search","price":"Rs. 23,999","ratings":"4 stars","reviews":"1541","title":"Moto X (2nd Generation) (White/Bamboo, 16 GB)"},{"emi":"EMI from Rs. 534 ","features":[],"image":"http://img6a.flixcart.com/image/mobile/w/t/n/motorola-moto-g-3rd-generation-ap3560ae7k8-125x125-imae9h4h8gkbpq56.jpeg","link":"http://www.flipkart.com/moto-g-3rd-generation/p/itme9ysjr7mfry3n?pid=MOBE6KK93JG5WKB2&ref=L%3A-4570749324777469411&srno=p_7&query=moto&otracker=from-search","price":"Rs. 10,999","ratings":"4 stars","reviews":"17405","title":"Moto G (3rd Generation) (Black, 16 GB)"},{"emi":"EMI from Rs. 607 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/w/w/z/motorola-moto-g-turbo-edition-xt1557-125x125-imaefgnkmprhzhzk.jpeg","link":"http://www.flipkart.com/moto-g-turbo/p/itmecc4uhbue7ve6?pid=MOBECC4UZTSGKWWZ&ref=L%3A-4570749324777469411&srno=p_8&query=moto&otracker=from-search","price":"Rs. 12,499","ratings":"4 stars","reviews":"1042","title":"Moto G Turbo Edition (Black, 16 GB)"},{"emi":"EMI from Rs. 534 ","features":[],"image":"http://img6a.flixcart.com/image/mobile/g/u/c/motorola-moto-g-3rd-generation-ap3522ad1k8-125x125-imae9h4kydnyervx.jpeg","link":"http://www.flipkart.com/moto-g-3rd-generation/p/itme9ysjr7mfry3n?pid=MOBE6KK9YZJBYGUC&ref=L%3A-4570749324777469411&srno=p_9&query=moto&otracker=from-search","price":"Rs. 10,999","ratings":"4 stars","reviews":"17405","title":"Moto G (3rd Generation) (White, 16 GB)"},{"emi":"EMI from Rs. 607 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/z/f/r/motorola-moto-g-turbo-edition-xt1557-125x125-imaefgnkpuqjzgew.jpeg","link":"http://www.flipkart.com/moto-g-turbo/p/itmecc4uhbue7ve6?pid=MOBECC4UQTJ5QZFR&ref=L%3A-4570749324777469411&srno=p_10&query=moto&otracker=from-search","price":"Rs. 12,499","ratings":"4 stars","reviews":"1042","title":"Moto G Turbo Edition (White, 16 GB)"},{"emi":"EMI from Rs. 291 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/a/c/f/motorola-moto-e-2nd-gen-xt1521-125x125-imae5yvnugydbf9d.jpeg","link":"http://www.flipkart.com/moto-e-2nd-gen-3g/p/itme85heggxfqjgs?pid=MOBE4G6GTTD33ZUT&ref=L%3A-4570749324777469411&srno=p_11&query=moto&otracker=from-search","price":"Rs. 5,999","ratings":"4 stars","reviews":"10565","title":"Moto E (2nd Gen) 3G (Black, 8 GB)"},{"emi":"EMI from Rs. 340 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/a/c/f/motorola-moto-e-2nd-gen-xt1521-125x125-imae5yvnugydbf9d.jpeg","link":"http://www.flipkart.com/moto-e-2nd-gen-4g/p/itme85hfdv6zztcj?pid=MOBE4G6GTH2QDACF&ref=L%3A-4570749324777469411&srno=p_12&query=moto&otracker=from-search","price":"Rs. 6,999","ratings":"4 stars","reviews":"2870","title":"Moto E (2nd Gen) 4G (Black, 8 GB)"},{"emi":"EMI from Rs. 291 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/t/n/d/motorola-moto-e-2nd-gen-xt1521-125x125-imae5yvnbrtaydnx.jpeg","link":"http://www.flipkart.com/moto-e-2nd-gen-3g/p/itme85heggxfqjgs?pid=MOBE4G6GH9EPGHKG&ref=L%3A-4570749324777469411&srno=p_13&query=moto&otracker=from-search","price":"Rs. 5,999","ratings":"4 stars","reviews":"10565","title":"Moto E (2nd Gen) 3G (White, 8 GB)"},{"emi":"EMI from Rs. 340 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/t/n/d/motorola-moto-e-2nd-gen-xt1521-125x125-imae5yvnbrtaydnx.jpeg","link":"http://www.flipkart.com/moto-e-2nd-gen-4g/p/itme85hfdv6zztcj?pid=MOBE4G6G2KHFYTND&ref=L%3A-4570749324777469411&srno=p_14&query=moto&otracker=from-search","price":"Rs. 6,999","ratings":"4 stars","reviews":"2870","title":"Moto E (2nd Gen) 4G (White, 8 GB)"},{"emi":"EMI from Rs. 1,552 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/k/p/p/motorola-moto-x-style-xt1572-125x125-imaebugedxgxfr6g.jpeg","link":"http://www.flipkart.com/moto-x-style/p/itmeajtqe4rnvzf8?pid=MOBEAJTQHXGXSKPP&ref=L%3A-4570749324777469411&srno=p_15&query=moto&otracker=from-search","price":"Rs. 31,999","ratings":"4 stars","reviews":"369","title":"Moto X Style (Black, 32 GB)"},{"emi":"EMI from Rs. 1,552 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/a/j/j/motorola-moto-x-style-xt1572-125x125-imaebugdrhfvggpp.jpeg","link":"http://www.flipkart.com/moto-x-style/p/itmeajtqe4rnvzf8?pid=MOBEBNKRWSPGYAJJ&ref=L%3A-4570749324777469411&srno=p_16&query=moto&otracker=from-search","price":"Rs. 31,999","ratings":"4 stars","reviews":"369","title":"Moto X Style (White and Champagne, 32 GB)"},{"emi":"EMI from Rs. 1,455 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/k/p/p/motorola-moto-x-style-xt1572-125x125-imaebugedxgxfr6g.jpeg","link":"http://www.flipkart.com/moto-x-style/p/itmeajtqebm7yc9b?pid=MOBEAJTQ4QEAJZ2H&ref=L%3A-4570749324777469411&srno=p_17&query=moto&otracker=from-search","price":"Rs. 29,999","ratings":"4 stars","reviews":"167","title":"Moto X Style (Black, 16 GB)"},{"emi":"","features":[],"image":"http://img6a.flixcart.com/image/screen-guard/tempered-glass/n/r/c/rudra-traders-moto-g2-125x125-imaefthfhzvg7xr7.jpeg","link":"http://www.flipkart.com/shop-buzz-temp-motog3-tempered-glass-motorola-moto-g-3rd-generation/p/itmea3kzahbgm2hv?pid=ACCEA3KZKZBUUSWJ&ref=L%3A-4570749324777469411&srno=p_18&query=moto&otracker=from-search","price":"Rs. 189","ratings":"3 stars","reviews":"28","title":"Shop Buzz Temp-MotoG3 Tempered Glass for Motorola Moto G (3rd Generation)"},{"emi":"EMI from Rs. 873 ","features":[],"image":"http://img5a.flixcart.com/image/mobile/7/q/2/motorola-xt1092-125x125-imaefs86tdch7rwg.jpeg","link":"http://www.flipkart.com/moto-x-2nd-generation/p/itme7ybgqhjherhy?pid=MOBEFS6SNU8QW7Q2&ref=L%3A-4570749324777469411&srno=p_19&query=moto&otracker=from-search","price":"Rs. 17,999","ratings":"4 stars","reviews":"636","title":"Moto X (2nd Generation) (Black, 32 GB)"},{"emi":"EMI from Rs. 1,552 ","features":[],"image":"http://img6a.flixcart.com/image/mobile/c/v/x/motorola-moto-turbo-xt1225-125x125-imae5fyxgh7qy6ag.jpeg","link":"http://www.flipkart.com/moto-turbo/p/itme45h87vyhb3mg?pid=MOBE45H673ZGUCVX&ref=L%3A-4570749324777469411&srno=p_20&query=moto&otracker=from-search","price":"Rs. 31,999","ratings":"4 stars","reviews":"265","title":"Moto Turbo (Black, 64 GB)"}],"success":true},"snapdeal":{"products":[{"image":"http://n4.sdlcdn.com/imgs/a/6/u/198x232/Moto-E-2nd-Gen-4G-SDL066587797-1-8d08e.jpg","link":"http://www.snapdeal.com/product/moto-e-2nd-gen-4g/682444504031#bcrumbSearch:moto","price":"Rs.  5,999","ratings":"4.3","reviews":"937","title":"Moto E (2nd Gen) 4G 8GB"},{"image":"http://n3.sdlcdn.com/imgs/a/7/h/198x232/MotoE2ndGen_FrOrt_BlckDev_LTE_RGB-4b7dc.jpg","link":"http://www.snapdeal.com/product/moto-e-2nd-gen-3g/627496057276#bcrumbSearch:moto","price":"Rs.  5,209","ratings":"4.3","reviews":"2757","title":"Moto E (2nd Gen) 3G 8GB"},{"image":"http://n2.sdlcdn.com/imgs/a/0/b/198x232/DXV-High-Quality-Flip-Cover-SDL809996169-1-227f5.jpg","link":"http://www.snapdeal.com/product/dxv-high-quality-flip-cover/657191473246#bcrumbSearch:moto","price":"Rs.  198","reviews":"","title":"DXV High Quality Flip Cover Case For Motorola Moto E - Pink"},{"image":"http://n1.sdlcdn.com/imgs/a/2/w/198x232/Rvage-Flip-Cover-For-Motorola-SDL907014515-1-5efb1.jpg","link":"http://www.snapdeal.com/product/rvage-flip-cover-for-motorola/643608362996#bcrumbSearch:moto","price":"Rs.  165","reviews":"","title":"Rvage Flip Cover For Motorola Moto E - Black"},{"image":"http://n1.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL189671242-1-1cc31.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/655884665629#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n4.sdlcdn.com/imgs/b/e/z/198x232/Nr-Back-Cover-For-Motorola-SDL339757156-1-a0cac.jpg","link":"http://www.snapdeal.com/product/nr-back-cover-for-motorola/623356965213#bcrumbSearch:moto","price":"Rs.  199","reviews":"","title":"Nr Back Cover For Motorola Moto E-blue"},{"image":"http://n1.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL113381669-1-940fb.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/618762708406#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n1.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL110526540-1-1082f.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/618954909888#bcrumbSearch:moto","price":"Rs.  449","ratings":"4.0","reviews":"1","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n3.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL174637195-1-4b5dc.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/619061174142#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n4.sdlcdn.com/imgs/b/e/z/198x232/Nr-Back-Cover-For-Moto-SDL337097600-1-6bb89.jpg","link":"http://www.snapdeal.com/product/nr-back-cover-for-moto/619335134196#bcrumbSearch:moto","price":"Rs.  199","reviews":"","title":"Nr Back Cover For Moto E-blue"},{"image":"http://n3.sdlcdn.com/imgs/b/b/p/198x232/Ezyprnt-Back-Skin-Sticker-For-SDL732919971-1-364ef.jpg","link":"http://www.snapdeal.com/product/ezyprnt-back-skin-sticker-for/619421819008#bcrumbSearch:moto","price":"Rs.  349","reviews":"","title":"ezyPRNT Skin Sticker for Motorola Moto E Philippe Coutinho Football Player"},{"image":"http://n3.sdlcdn.com/imgs/a/9/f/198x232/Zapcase-Printed-Back-Cover-For-SDL741097939-1-58143.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/619576470348#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n3.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL189476236-1-a35ae.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/620191674838#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n1.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL132362982-1-9b01c.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/620659124840#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL194911092-1-7e752.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/621039876314#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n1.sdlcdn.com/imgs/b/b/p/198x232/Ezyprnt-Back-Skin-Sticker-For-SDL716112232-1-2cb11.jpg","link":"http://www.snapdeal.com/product/ezyprnt-back-skin-sticker-for/621135046827#bcrumbSearch:moto","price":"Rs.  349","reviews":"","title":"ezyPRNT Skin Sticker for Motorola Moto E Alexis Sanchez 'el nino' Football Player"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL130840394-1-b6b26.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/621138135967#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n3.sdlcdn.com/imgs/b/c/x/198x232/Serkudos-Back-Cover-For-Moto-SDL673570365-1-4b1aa.jpg","link":"http://www.snapdeal.com/product/serkudos-back-cover-for-moto/621170220566#bcrumbSearch:moto","price":"Rs.  250","reviews":"","title":"Serkudos Back Cover For Moto E-Multicolour"},{"image":"http://n4.sdlcdn.com/imgs/b/b/p/198x232/Ezyprnt-Back-Skin-Sticker-For-SDL726678006-1-47da1.jpg","link":"http://www.snapdeal.com/product/ezyprnt-back-skin-sticker-for/621545634454#bcrumbSearch:moto","price":"Rs.  349","reviews":"","title":"ezyPRNT Skin Sticker for Motorola Moto E Diego Costa 'el cholo' Football Player"},{"image":"http://n4.sdlcdn.com/imgs/b/c/x/198x232/Serkudos-Back-Cover-For-Moto-SDL673316090-1-cec1a.jpg","link":"http://www.snapdeal.com/product/serkudos-back-cover-for-moto/621568163245#bcrumbSearch:moto","price":"Rs.  245","reviews":"","title":"Serkudos Back Cover For Moto E-Multicolour"},{"image":"http://n1.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL104238113-1-b2536.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/621835122900#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n3.sdlcdn.com/imgs/b/d/l/198x232/Accezory-Back-Cover-for-Moto-SDL817323295-1-c5d55.jpg","link":"http://www.snapdeal.com/product/accezory-back-cover-for-moto/621842339444#bcrumbSearch:moto","price":"Rs.  285","reviews":"","title":"Accezory Back Cover for Moto E 1st Gen"},{"image":"http://n1.sdlcdn.com/imgs/b/e/z/198x232/Nr-Back-Cover-For-Moto-SDL347539776-1-8c582.jpg","link":"http://www.snapdeal.com/product/nr-back-cover-for-moto/621976824302#bcrumbSearch:moto","price":"Rs.  199","reviews":"","title":"Nr Back Cover For Moto E-purple"},{"image":"http://n1.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL204696039-1-eea50.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/622608598216#bcrumbSearch:moto","price":"Rs.  449","ratings":"5.0","reviews":"1","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/b/b/p/198x232/Ezyprnt-Back-Skin-Sticker-For-SDL716897702-1-2c70b.jpg","link":"http://www.snapdeal.com/product/ezyprnt-back-skin-sticker-for/622753736651#bcrumbSearch:moto","price":"Rs.  349","reviews":"","title":"ezyPRNT Skin Sticker for Motorola Moto E Gareth Bale 'fk specialist' Football Player"},{"image":"http://n4.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL128263468-1-dd5a4.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/623190785432#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL103894130-1-5892e.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/623556107162#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n4.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL160310800-1-89b0b.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/623682307052#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL092958543-1-1f390.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/623897381251#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/a/9/f/198x232/Zapcase-Printed-Back-Cover-For-SDL767152524-1-21c66.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/624121882700#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n3.sdlcdn.com/imgs/b/c/x/198x232/Serkudos-Back-Cover-For-Moto-SDL684028769-1-a9dcf.jpg","link":"http://www.snapdeal.com/product/serkudos-back-cover-for-moto/624288842753#bcrumbSearch:moto","price":"Rs.  249","reviews":"","title":"Serkudos Back Cover For Moto E-Multicolour"},{"image":"http://n4.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL155639437-1-cfc76.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/624500529940#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n4.sdlcdn.com/imgs/b/h/v/198x232/Nosson-Flip-Cover-For-Motorola-SDL026989690-1-e9600.jpg","link":"http://www.snapdeal.com/product/nosson-flip-cover-for-motorola/624658895493#bcrumbSearch:moto","price":"Rs.  259","reviews":"","title":"Nosson Flip Cover For Motorola Moto E - Black"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL181848655-1-5681d.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/624666168141#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n4.sdlcdn.com/imgs/b/b/p/198x232/Ezyprnt-Back-Skin-Sticker-For-SDL729461085-1-10bdf.jpg","link":"http://www.snapdeal.com/product/ezyprnt-back-skin-sticker-for/624829276002#bcrumbSearch:moto","price":"Rs.  349","reviews":"","title":"ezyPRNT Skin Sticker for Motorola Moto E Luiz Saurez 'EL pistolero' Football Player"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL191184988-1-d2a5c.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/624833858033#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL203181882-1-881c9.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/625153600747#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n4.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL105676109-1-28739.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/625634286997#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/b/b/p/198x232/Ezyprnt-Back-Skin-Sticker-For-SDL742001500-1-aeaa4.jpg","link":"http://www.snapdeal.com/product/ezyprnt-back-skin-sticker-for/625771417405#bcrumbSearch:moto","price":"Rs.  349","reviews":"","title":"ezyPRNT Skin Sticker for Motorola Moto E Luiz Saurez 'EL pistolero' Football Player"},{"image":"http://n1.sdlcdn.com/imgs/a/9/f/198x232/Zapcase-Printed-Back-Cover-For-SDL730031807-1-e5494.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/625773754846#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/b/d/t/198x232/Bizarre-Kraftz-Back-Cover-for-SDL957233862-1-c2a60.jpg","link":"http://www.snapdeal.com/product/bizarre-kraftz-back-cover-for/625963342485#bcrumbSearch:moto","price":"Rs.  287","reviews":"","title":"Bizarre Kraftz Back Cover for Moto E"},{"image":"http://n3.sdlcdn.com/imgs/a/9/f/198x232/Zapcase-Printed-Back-Cover-For-SDL707489496-1-bcc35.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/626070236223#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL195579820-1-fbe89.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/626203473160#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n3.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL095993977-1-79f30.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/626821583990#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n4.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL098217745-1-cdf93.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/626922837363#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n3.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL201770073-1-71bb2.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/627252319902#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"},{"image":"http://n1.sdlcdn.com/imgs/b/e/z/198x232/Nr-Back-Cover-For-Moto-SDL340240556-1-4e98f.jpg","link":"http://www.snapdeal.com/product/nr-back-cover-for-moto/628492126013#bcrumbSearch:moto","price":"Rs.  199","reviews":"","title":"Nr Back Cover For Moto E-pink"},{"image":"http://n2.sdlcdn.com/imgs/a/9/q/198x232/Zapcase-Printed-Back-Cover-For-SDL187640833-1-b97c7.jpg","link":"http://www.snapdeal.com/product/zapcase-printed-back-cover-for/628648412698#bcrumbSearch:moto","price":"Rs.  449","reviews":"","title":"Zapcase Printed Back Cover For Motorola Moto E2 - Multicolor"}],"success":true}}};

var results, SEARCHING = false;

var container =
    '\
      <div class="container">\
        <div class="image">\
        </div>\
        <div class="price">\
          <h4></h4>\
        </div>\
        <div class="title">\
          <a target="_blank"><h3 class="truncate"></h3></a>\
        </div>\
        <div class="ratings">\
          <span></span>\
        </div>\
        <div class="reviews">\
          <span></span>\
        </div>\
      </div>\
      ';

$(document).ready(function () {
  $('.products').hide();
  $('.error').hide();
  $('.more-results').hide();
  $('.more-results-button').hide();
  $('.more-results-head').hide();
  $('.more-results-error').hide();
  $('.more-results .flipkart-img').hide();
  $('.more-results .snapdeal-img').hide();
  
  function getResults() {
    if (SEARCHING) return;
    
    SEARCHING = true;
    
    $('.products').hide();
    $('.products .container').remove();
    $('.error').hide();
    $('.search i').addClass('search-animation');
    $('.more-results').hide();
    $('.more-results-button').hide();
    $('.more-results-head').hide();
    $('.more-results-erro').hide();
    $('.more-results .flipkart-img').hide();
    $('.more-results .snapdeal-img').hide();

    $('.products .flipkart, .products .snapdeal').append(container);

    var search = $('#search-input').val();

    var flipSort, snapSort;

    switch ($('input:checked').attr('value')) {
      case '2':
        flipSort = 'popularity';
        snapSort = 'plrty';
        break;
      case '3':
        flipSort = 'price_desc';
        snapSort = 'phtl';
        break;
      case '4':
        flipSort = 'price_asc';
        snapSort = 'plth';
        break;
      default:
        flipSort = 'relevance';
        snapSort = 'rlvncy';
    }
    
    $.ajax({
      url: '/scrape?q=' + search + '&flipSort=' + flipSort + '&snapSort=' + snapSort,
      dataType: 'json',
      complete: function (res, status) {
        SEARCHING = false;
        $('.search i').removeClass('search-animation');
      },
      success: function (data) {
        results = data;
        if (data.success) {
          var $flipkart = $('.products .flipkart'),
            $snapdeal = $('.products .snapdeal')
          
          $flipkart.find('.title h3').removeClass('truncate');
          $snapdeal.find('.title h3').removeClass('truncate');
          
          if (data.results.flipkart.success) {
            var flipkart = data.results.flipkart.products[0]

            $('.flipkart-error').hide()
            $('.products .flipkart .container').show()

            $flipkart.find('.image').css('background-image', 'url(' + flipkart.image + ')');
            $flipkart.find('.price h4').text(flipkart.price);
            $flipkart.find('.title a').attr('href', flipkart.link);
            $flipkart.find('.title h3').text(flipkart.title);
            $flipkart.find('.ratings span').html("&#127775; " + (flipkart.ratings || "0").replace(/[^0-9]/g, ''));
            $flipkart.find('.reviews span').text((flipkart.reviews || "0") + " reviews");
          } else {
            $('.flipkart-error').show()
            $('.products .flipkart .container').hide()
          }

          if (data.results.snapdeal.success) {
            var snapdeal = data.results.snapdeal.products[0]

            $('.snapdeal-error').hide()
            $('.products .snapdeal .container').show()

            $snapdeal.find('.image').css('background-image', 'url(' + snapdeal.image + ')');
            $snapdeal.find('.price h4').text(snapdeal.price);
            $snapdeal.find('.title a').attr('href', snapdeal.link);
            $snapdeal.find('.title h3').text(snapdeal.title);
            $snapdeal.find('.ratings span').html("&#127775; " + (snapdeal.ratings || "0"));
            $snapdeal.find('.reviews span').text((snapdeal.reviews || "0") + " reviews");

          } else {
            $('.snapdeal-error').show()
            $('.products .snapdeal .container').hide()
          }

          $('.products').fadeIn();
          $('.more-results-button').show();
          $('.more-results-head').show();


          compare($flipkart,
            $snapdeal,
            data.results.flipkart.success ? data.results.flipkart.products[0] : {},
            data.results.snapdeal.success ? data.results.snapdeal.products[0] : {});
        } else {
          $('.error').show()
        }
      },
      error: function (res) {
        $('.error').show();
      }
    })
  };

  function compare($flipkart, $snapdeal, flipData, snapData) {
    $('.winner, .loser').removeClass('winner loser');

    var flipScore = 0,
      snapScore = 0,
      flipPrice = (flipData.price || '999999999').replace(/Rs./gi, ''),
      snapPrice = (snapData.price || '999999999').replace(/Rs./gi, ''),
      flipRatings = flipData.ratings || '0',
      snapRatings = snapData.ratings || '0',
      flipReviews = flipData.reviews || '0',
      snapReviews = snapData.reviews || '0'

    if (+flipPrice.replace(/[^0-9]/g, '') < +snapPrice.replace(/[^0-9]/g, '')) {
      $flipkart.find('.price').addClass('winner')
      $snapdeal.find('.price').addClass('loser')
      flipScore++;
    } else {
      $snapdeal.find('.price').addClass('winner')
      $flipkart.find('.price').addClass('loser')
      snapScore++;
    }

    if (+flipRatings.replace(/[^0-9.]+/g, '') > +snapRatings.replace(/[^0-9.]+/g, '')) {
      $flipkart.find('.ratings').addClass('winner')
      $snapdeal.find('.ratings').addClass('loser')
      flipScore++;
    } else {
      $snapdeal.find('.ratings').addClass('winner')
      $flipkart.find('.ratings').addClass('loser')
      snapScore++;
    }

    if (+flipReviews.replace(/[^0-9]+/g, '') > +snapReviews.replace(/[^0-9]+/g, '')) {
      $flipkart.find('.reviews').addClass('winner')
      $snapdeal.find('.reviews').addClass('loser')
      flipScore++;
    } else {
      $snapdeal.find('.reviews').addClass('winner')
      $flipkart.find('.reviews').addClass('loser')
      snapScore++;
    }

    $flipkart.addClass(flipScore > snapScore ? "winner" : "loser");
    $snapdeal.addClass(flipScore > snapScore ? "loser" : "winner");
  };

  $('#search-input').keyup(function (e) {
    adjustSearchBar();
  });

  $(document).keypress(function (e) {
    var $target = $(e.target);

    if (!$target.is($('.filter input'))) {
      $('#search-input').focus();
      adjustSearchBar();
    }

    if (e.which == 13 && $target.is($('#search-input'))) {
      getResults();

      return false;
    }
  });

  $('.sortby input').click(function () {
    if ($('#search-input').val() !== '') getResults();
  });

  function adjustSearchBar() {
    var width = "250px";
    var borderColor = "#fff";

    if ($("#search-input").val() == "") {
      width = "0px";
      borderColor = "transparent";
    }

    $('#search-input').css('width', width);
    $('#search-input').css('border-color', borderColor);
  };

  $('.search i').click(function () {
    $('#search-input').css('width', '250px');
    $('#search-input').css('border-color', '#fff');
    $('#search-input').focus();

    if ($('#search-input').val() != '') getResults();
  });

  $('html').click(function (e) {
    var target = $(e.target)
    if (!target.is($(".search i")) && !target.is($('#search-input'))) {
      adjustSearchBar();
    }
  });
  
  $('#more-results').click(function() {
    $('.more-results').slideDown('slow', function() {
      $('html, body').animate({scrollTop: $('#filter').offset().top});
    });
    
    $('.more-results .flipkart .container').remove();
    $('.more-results .snapdeal .container').remove();
  });
  
  $('.more-results form').submit(function(e) {
    e.preventDefault();
  });
  
  function filter(val) {
    var from = $('#from').val() === '' ? 0 : +$('#from').val(),
        to   = $('#to').val() === '' ? Number.MAX_VALUE : +$('#to').val(),
        reviews = $('#reviews').val() === '' ? 0 : +$('#reviews').val(),
        ratings = $('#ratings').val() === '' ? 0 : +$('#ratings').val(),
        keyword = $('#keyword').val(),
        valPrice = val.price ? val.price.replace(/Rs.|[^0-9.]/gi, '') : 0,
        valReviews = val.reviews ? val.reviews.replace(/[^0-9]/g, '') : 0,
        valRatings = val.ratings ? val.ratings.replace(/[^0-9.]/g, '') : 0,
        valTitle = val.title ? val.title : '';
    
    if (valPrice >= from &&
       valPrice <= to &&
       valReviews >= reviews &&
       valRatings >= ratings &&
       (new RegExp(keyword, "i")).test(valTitle)) {
      return true;
    } else {
      return false;
    }
  };
  
  $('.filter-button').click(function() {
    $('.more-results .flipkart .container').remove();
    $('.more-results .snapdeal .container').remove();

    if (results.success) {
      if (results.results.flipkart.success) {
        $.each(results.results.flipkart.products, function(i, val) {
          
          if (!filter(val)) return;
          
          $('.more-results .flipkart').append(container);
          
          var $container = $('.more-results .flipkart .container:last-child');
          
          $container.find('.image').css('background-image', 'url(' + val.image + ')');
          $container.find('.price h4').text(val.price);
          $container.find('.title a').attr('href', val.link);
          $container.find('.title h3').text(val.title);
          $container.find('.ratings span').html("&#127775; " + (val.ratings || "0").replace(/[^0-9]/g, ''));
          $container.find('.reviews span').text((val.reviews || "0") + " reviews");
          
          if ($container.find('.title h3').text() === '') {
            $container.remove();
          }
        });
      }
      
      if (results.results.snapdeal.success) {
        $.each(results.results.snapdeal.products, function (i, val) {
          
          if (!filter(val)) return;
          
          $('.more-results .snapdeal').append(container);
          
          var $container = $('.more-results .snapdeal .container:last-child');
          
          $container.find('.image').css('background-image', 'url(' + val.image + ')');
          $container.find('.price h4').text(val.price);
          $container.find('.title a').attr('href', val.link);
          $container.find('.title h3').text(val.title);
          $container.find('.ratings span').html("&#127775; " + (val.ratings || "0"));
          $container.find('.reviews span').text((val.reviews || "0") + " reviews");
          
          if ($container.find('.title h3').text() === '') {
            $container.remove();
          }
        })
      }
      
      $('.more-results .flipkart-img').show();
      $('.more-results .snapdeal-img').show();
    } else {
      $('.more-results-error').show();
    }
  });
  
  $('#flipkart-label').click(function() {
    $('.more-results .flipkart').toggle($('#flipkart-label').checked);    
  });
  
  $('#snapdeal-label').click(function() {
    $('.more-results .snapdeal').toggle($('#snapdeal-label').checked);
  });
});
